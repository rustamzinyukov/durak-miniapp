# üìä –°–∏—Å—Ç–µ–º–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ - –û–±–∑–æ—Ä –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã

### üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤
```
durak-miniapp-clean/
‚îú‚îÄ‚îÄ script.js                    # –û—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ –∏–≥—Ä—ã –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
‚îú‚îÄ‚îÄ index.html                   # HTML —Å –º–æ–¥–∞–ª—å–Ω—ã–º –æ–∫–Ω–æ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
‚îú‚îÄ‚îÄ api/
‚îÇ   ‚îî‚îÄ‚îÄ stats/
‚îÇ       ‚îî‚îÄ‚îÄ load.js              # Mock API endpoint –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏
‚îî‚îÄ‚îÄ (localStorage)               # –õ–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –±—Ä–∞—É–∑–µ—Ä–∞
```

## üóÑÔ∏è –•—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö

### 1. **–û—Å–Ω–æ–≤–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ: Backend API**
- **URL**: `/api/stats/load` –∏ `/api/stats/save`
- **–ú–µ—Ç–æ–¥**: GET (–∑–∞–≥—Ä—É–∑–∫–∞) –∏ POST (—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ)
- **–§–æ—Ä–º–∞—Ç**: JSON
- **–°—Ç–∞—Ç—É—Å**: ‚ùå **–ù–ï –†–ï–ê–õ–ò–ó–û–í–ê–ù** (—Ç–æ–ª—å–∫–æ mock —Ñ–∞–π–ª)

### 2. **Fallback —Ö—Ä–∞–Ω–∏–ª–∏—â–µ: localStorage**
- **–ö–ª—é—á**: `'playerStats'`
- **–§–æ—Ä–º–∞—Ç**: JSON —Å—Ç—Ä–æ–∫–∞
- **–°—Ç–∞—Ç—É—Å**: ‚úÖ **–†–ê–ë–û–¢–ê–ï–¢** (–æ—Å–Ω–æ–≤–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ)

### 3. **–í—Ä–µ–º–µ–Ω–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ: state.playerStats**
- **–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ**: –í –ø–∞–º—è—Ç–∏ –±—Ä–∞—É–∑–µ—Ä–∞
- **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ**: –í —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- **–°—Ç–∞—Ç—É—Å**: ‚úÖ **–†–ê–ë–û–¢–ê–ï–¢**

## üÜî –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∏–≥—Ä–æ–∫–∞

### ‚ùå **–ü–†–û–ë–õ–ï–ú–ê: –ù–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω–æ–≥–æ ID –∏–≥—Ä–æ–∫–∞**

**–¢–µ–∫—É—â–∞—è —Å–∏—Ç—É–∞—Ü–∏—è:**
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–∏–≤—è–∑–∞–Ω–∞ –∫ –±—Ä–∞—É–∑–µ—Ä—É/—É—Å—Ç—Ä–æ–π—Å—Ç–≤—É
- –ù–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –∏–ª–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
- –ù–µ—Ç —Å–≤—è–∑–∏ —Å Telegram WebApp –¥–∞–Ω–Ω—ã–º–∏
- –ü—Ä–∏ —Å–º–µ–Ω–µ –±—Ä–∞—É–∑–µ—Ä–∞/—É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ç–µ—Ä—è–µ—Ç—Å—è

**–í–æ–∑–º–æ–∂–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è:**
1. **Telegram WebApp ID** - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `tg.initDataUnsafe.user.id`
2. **–õ–æ–∫–∞–ª—å–Ω—ã–π UUID** - –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ
3. **Telegram username** - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `tg.initDataUnsafe.user.username`

## üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏

### üéØ **–û–±—ä–µ–∫—Ç playerStats:**
```javascript
{
  totalGames: 0,        // –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–≥—Ä
  wins: 0,              // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–±–µ–¥
  losses: 0,            // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ—Ä–∞–∂–µ–Ω–∏–π
  currentStreak: 0,     // –¢–µ–∫—É—â–∞—è —Å–µ—Ä–∏—è –ø–æ–±–µ–¥
  bestStreak: 0,        // –õ—É—á—à–∞—è —Å–µ—Ä–∏—è –ø–æ–±–µ–¥
  lastResult: null      // –ü–æ—Å–ª–µ–¥–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç ('win'/'loss')
}
```

### üìà **–†–∞—Å—á–µ—Ç–Ω—ã–µ –ø–æ–ª—è:**
- **–ü—Ä–æ—Ü–µ–Ω—Ç –ø–æ–±–µ–¥**: `(wins / totalGames) * 100`
- **–ü—Ä–æ—Ü–µ–Ω—Ç –ø–æ—Ä–∞–∂–µ–Ω–∏–π**: `(losses / totalGames) * 100`

## üîÑ –ñ–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏

### 1. **–ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ**
```javascript
// –í main() —Ñ—É–Ω–∫—Ü–∏–∏
loadPlayerStats(); // –ó–∞–≥—Ä—É–∂–∞–µ—Ç –∏–∑ API –∏–ª–∏ localStorage
```

### 2. **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ –∏–≥—Ä—ã**
```javascript
// –í showEndgameModal() —Ñ—É–Ω–∫—Ü–∏–∏
const humanWon = title === "–í—ã –≤—ã–∏–≥—Ä–∞–ª–∏!";
updatePlayerStats(humanWon ? 'win' : 'loss');
```

### 3. **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è**
```javascript
// –í updatePlayerStats() —Ñ—É–Ω–∫—Ü–∏–∏
StatsAPI.saveStats(state.playerStats); // –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ API –∏ localStorage
```

## üéÆ –¢–æ—á–∫–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏

### ‚úÖ **–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:**
- **–ö–æ–Ω–µ—Ü –∏–≥—Ä—ã** - –∫–æ–≥–¥–∞ –∫–æ–ª–æ–¥–∞ –ø—É—Å—Ç–∞ –∏ —É –∫–æ–≥–æ-—Ç–æ –∑–∞–∫–æ–Ω—á–∏–ª–∏—Å—å –∫–∞—Ä—Ç—ã
- **–ü–æ–±–µ–¥–∞ –∏–≥—Ä–æ–∫–∞** - `totalGames++`, `wins++`, –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–µ—Ä–∏–π
- **–ü–æ—Ä–∞–∂–µ–Ω–∏–µ –∏–≥—Ä–æ–∫–∞** - `totalGames++`, `losses++`, —Å–±—Ä–æ—Å —Å–µ—Ä–∏–∏

### ‚ùå **–ù–ï —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:**
- **–°–¥–∞—á–∞ –∏–≥—Ä—ã** - –∫–æ–≥–¥–∞ –∏–≥—Ä–æ–∫ –Ω–∞–∂–∏–º–∞–µ—Ç "–í–∑—è—Ç—å"
- **–ü—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã** - –≤–æ –≤—Ä–µ–º—è –∏–≥—Ä—ã
- **–î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞** - –ø–æ —Ç–µ–º–∞–º, –≤—Ä–µ–º–µ–Ω–∏ –∏–≥—Ä—ã, —Å–ª–æ–∂–Ω–æ—Å—Ç–∏

## üîß API –∫–ª–∏–µ–Ω—Ç (StatsAPI)

### üì§ **–ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏:**
```javascript
async loadStats() {
  try {
    // 1. –ü—ã—Ç–∞–µ–º—Å—è –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å —Å–µ—Ä–≤–µ—Ä–∞
    const response = await fetch('/api/stats/load');
    if (response.ok) return await response.json();
  } catch (e) {
    // 2. Fallback –Ω–∞ localStorage
    const saved = localStorage.getItem('playerStats');
    return saved ? JSON.parse(saved) : defaultStats;
  }
}
```

### üíæ **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏:**
```javascript
async saveStats(stats) {
  try {
    // 1. –ü—ã—Ç–∞–µ–º—Å—è —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞ —Å–µ—Ä–≤–µ—Ä
    await fetch('/api/stats/save', {
      method: 'POST',
      body: JSON.stringify(stats)
    });
  } catch (e) {
    // 2. Fallback –Ω–∞ localStorage
    localStorage.setItem('playerStats', JSON.stringify(stats));
  }
}
```

## üéØ –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏

### üì± **UI —ç–ª–µ–º–µ–Ω—Ç—ã:**
- **–í—Å–µ–≥–æ –∏–≥—Ä**: `totalGames`
- **–ü–æ–±–µ–¥—ã**: `wins`
- **–ü–æ—Ä–∞–∂–µ–Ω–∏—è**: `losses`
- **–ü—Ä–æ—Ü–µ–Ω—Ç –ø–æ–±–µ–¥**: `(wins / totalGames) * 100`
- **–¢–µ–∫—É—â–∞—è —Å–µ—Ä–∏—è**: `currentStreak`
- **–õ—É—á—à–∞—è —Å–µ—Ä–∏—è**: `bestStreak`

### üé® **–°—Ç–∏–ª–∏:**
- Grid layout –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
- –¢–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ü–≤–µ—Ç–∞
- –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π –¥–∏–∑–∞–π–Ω

## üö® –¢–µ–∫—É—â–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

### 1. **–ù–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω–æ–≥–æ ID –∏–≥—Ä–æ–∫–∞**
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–∏–≤—è–∑–∞–Ω–∞ –∫ –±—Ä–∞—É–∑–µ—Ä—É
- –ü—Ä–∏ —Å–º–µ–Ω–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ —Ç–µ—Ä—è–µ—Ç—Å—è
- –ù–µ—Ç —Å–≤—è–∑–∏ —Å Telegram

### 2. **Mock API**
- –°–µ—Ä–≤–µ—Ä–Ω—ã–µ endpoints –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã
- –¢–æ–ª—å–∫–æ localStorage fallback
- –ù–µ—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –º–µ–∂–¥—É —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏

### 3. **–û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞**
- –¢–æ–ª—å–∫–æ –±–∞–∑–æ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏
- –ù–µ—Ç –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏ –ø–æ —Ç–µ–º–∞–º
- –ù–µ—Ç –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –º–µ—Ç—Ä–∏–∫

## üîÆ –í–æ–∑–º–æ–∂–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

### 1. **Telegram WebApp –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è**
```javascript
// –ü–æ–ª—É—á–µ–Ω–∏–µ ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ Telegram
const userId = tg.initDataUnsafe?.user?.id;
const username = tg.initDataUnsafe?.user?.username;
```

### 2. **–†–µ–∞–ª—å–Ω—ã–π backend API**
```javascript
// –°–µ—Ä–≤–µ—Ä–Ω—ã–µ endpoints
POST /api/stats/save
GET /api/stats/load/:userId
PUT /api/stats/update/:userId
```

### 3. **–†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞**
```javascript
{
  // –ë–∞–∑–æ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏
  totalGames: 0,
  wins: 0,
  losses: 0,
  
  // –î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ —Ç–µ–º–∞–º
  themeStats: {
    casino: { games: 0, wins: 0 },
    tavern: { games: 0, wins: 0 },
    underground: { games: 0, wins: 0 }
  },
  
  // –í—Ä–µ–º–µ–Ω–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏
  averageGameTime: 0,
  totalPlayTime: 0,
  
  // –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è
  achievements: [],
  
  // –†–µ–π—Ç–∏–Ω–≥
  rating: 1000,
  rank: '–ù–æ–≤–∏—á–æ–∫'
}
```

## üìã –†–µ–∑—é–º–µ

### ‚úÖ **–ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
- –õ–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ localStorage
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø–æ—Å–ª–µ –∏–≥—Ä—ã
- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º
- Fallback —Å–∏—Å—Ç–µ–º–∞ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö API

### ‚ùå **–ß—Ç–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
- –°–µ—Ä–≤–µ—Ä–Ω—ã–µ API endpoints
- –£–Ω–∏–∫–∞–ª—å–Ω–∞—è –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∏–≥—Ä–æ–∫–∞
- –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –º–µ–∂–¥—É —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏
- –î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

### üéØ **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:**
1. **–î–æ–±–∞–≤–∏—Ç—å Telegram WebApp ID** –¥–ª—è –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
2. **–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Ä–µ–∞–ª—å–Ω—ã–π backend API** –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
3. **–†–∞—Å—à–∏—Ä–∏—Ç—å –º–µ—Ç—Ä–∏–∫–∏** –¥–ª—è –±–æ–ª–µ–µ –¥–µ—Ç–∞–ª—å–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
4. **–î–æ–±–∞–≤–∏—Ç—å –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è** –¥–ª—è –º–æ—Ç–∏–≤–∞—Ü–∏–∏ –∏–≥—Ä–æ–∫–æ–≤

–¢–µ–∫—É—â–∞—è —Å–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –ª–æ–∫–∞–ª—å–Ω–æ, –Ω–æ –Ω–µ –≥–æ—Ç–æ–≤–∞ –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞ –±–µ–∑ backend API –∏ —É–Ω–∏–∫–∞–ª—å–Ω–æ–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.


