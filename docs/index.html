<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, viewport-fit=cover"
    />
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate, max-age=0">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <meta name="cache-control" content="no-cache">
    <meta name="expires" content="0">
    <meta name="pragma" content="no-cache">
    <link rel="manifest" href="./manifest.json" />
    <meta name="theme-color" content="#d4af37" />
    <title>–î—É—Ä–∞–∫ - –ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∞—è –∫–∞—Ä—Ç–æ—á–Ω–∞—è –∏–≥—Ä–∞</title>
    <meta name="description" content="–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∞—è –∫–∞—Ä—Ç–æ—á–Ω–∞—è –∏–≥—Ä–∞ –î—É—Ä–∞–∫ —Å –∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–º –ò–ò –î–∂–æ–∫–µ—Ä–æ–º. –ò–≥—Ä–∞–π—Ç–µ –≤ Telegram Mini App!" />
    <!-- Prevent caching -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="./style.css?v=76" />
    <link rel="stylesheet" href="./achievements.css?v=7" />
    <!-- Telegram Mini App SDK (browser global) -->
    <script src="https://cdn.jsdelivr.net/npm/@twa-dev/sdk@latest"></script>
    <!-- Quotes system -->
    <script src="./quotes/casino/donald.js"></script>
    <script src="./quotes/tavern/whiteWolf.js"></script>
    <script src="./quotes/underground/sergeant.js"></script>
  </head>
  <body>
    <!-- –≠–∫—Ä–∞–Ω –∑–∞–≥—Ä—É–∑–∫–∏ -->
    <div id="loadingScreen" class="loading-screen">
      <div class="loading-content">
        <div class="loading-logo">
          <img src="./logo/durak.png" alt="–î—É—Ä–∞–∫" class="loading-logo-image" />
        </div>
        <h1 class="loading-title">–î—É—Ä–∞–∫</h1>
        <p class="loading-subtitle">–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∞—è –∫–∞—Ä—Ç–æ—á–Ω–∞—è –∏–≥—Ä–∞</p>
        <div class="loading-progress">
          <div class="loading-progress-bar">
            <div class="loading-progress-fill" id="loadingProgressFill"></div>
          </div>
          <div class="loading-progress-text" id="loadingProgressText">–ó–∞–≥—Ä—É–∑–∫–∞ —Ä–µ—Å—É—Ä—Å–æ–≤...</div>
        </div>
        <div class="loading-spinner">
          <div class="spinner"></div>
        </div>
      </div>
    </div>

    <div id="app" style="display: none;">
      <header class="app-header">
        <div class="header-left">
          <button class="stats-button" id="statsButton" title="–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞">üìä</button>
        </div>
        <div class="header-center">
          <div class="game-logo">
            <img src="" alt="–î—É—Ä–∞–∫" class="logo-image" id="gameLogo" />
          </div>
        </div>
        <div class="header-right">
          <div class="sound-controls-group">
            <button class="sound-effects-button" id="soundEffectsButton" title="–ó–≤—É–∫–æ–≤—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã">üîä</button>
            <button class="background-music-button" id="backgroundMusicButton" title="–§–æ–Ω–æ–≤–∞—è –º—É–∑—ã–∫–∞">üé∂</button>
          </div>
          <button class="profile-button" id="profileButton" title="–ü—Ä–æ—Ñ–∏–ª—å">üë§</button>
          <button class="debug-button" id="debugButton" title="–û—Ç–ª–∞–¥–∫–∞ Telegram" style="background: #ff6b6b; color: white; border: none; border-radius: 50%; width: 32px; height: 32px; display: flex; align-items: center; justify-content: center; font-size: 16px; cursor: pointer; transition: all 0.2s ease;">üîç</button>
          <button class="settings-button" id="settingsButton" data-action="options" title="–ù–∞—Å—Ç—Ä–æ–π–∫–∏">‚öôÔ∏è</button>
        </div>
      </header>

      <main class="table-area">
        <section class="opponents" id="opponents">
          <div class="opponent-panel">
            <div class="opponent-avatar">
              <img src="./themes/casino/icons/person/base.jpg" alt="Opponent" id="opponentAvatar" />
            </div>
            <div class="opponent-info">
              <div class="opponent-name" id="opponentName">–î–æ–Ω–∞–ª—å–¥</div>
              <div class="opponent-comment" id="opponentComment">–ì–æ—Ç–æ–≤ –∫ –∏–≥—Ä–µ!</div>
              <div class="opponent-hint" id="opponentHint" style="font-size: 10px; color: #888; margin-top: 2px;"></div>
            </div>
            <div class="opponent-cards" id="opponentCards">
              <!-- Cards will be added here by JavaScript -->
            </div>
          </div>
        </section>

        <section class="table-wrap">
          <section class="table" id="table">
            <div class="attack-row" id="attackRow"></div>
            <div class="defense-row" id="defenseRow"></div>
          </section>
          <aside class="table-side" id="tableSide">
            <div class="indicator-wrap">
              <div class="label" id="trumpLabel">Trump</div>
              <div class="card indicator" id="trumpCard"></div>
            </div>
            <div class="indicator-wrap">
              <div class="label" id="deckLabel">Deck</div>
              <div class="card indicator" id="deckCard"></div>
            </div>
          </aside>
        </section>

      </main>

      <footer class="hand" id="playerHand"></footer>
      
      <section class="actions">
        <button id="btnAdd" data-action="attack" disabled><span class="icon"></span> Play Selected</button>
        <button id="btnTake" data-action="take" disabled><span class="icon"></span> Take Cards</button>
        <button id="btnEnough" data-action="enough" disabled><span class="icon"></span> Enough</button>
      </section>
    </div>


    <!-- Settings Overlay -->
    <div class="settings-overlay" id="settingsOverlay"></div>

    <!-- Settings Menu -->
    <div class="settings-menu" id="settingsMenu">
      <div class="settings-header">
        <h2 class="settings-title">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h2>
        <button class="settings-close" id="settingsClose">√ó</button>
      </div>
      <div class="settings-content">
        <div class="settings-section">
          <h3 class="settings-section-title">–í–∏–∑—É–∞–ª—å–Ω—ã–µ —Ç–µ–º—ã</h3>
          <div class="theme-grid">
            <div class="theme-option" data-theme="casino">
              <div class="theme-preview"></div>
              <div class="theme-name">üé∞ –ö–∞–∑–∏–Ω–æ</div>
              <div class="theme-description">–†–æ—Å–∫–æ—à–Ω–æ–µ –∫–∞–∑–∏–Ω–æ</div>
            </div>
            <div class="theme-option" data-theme="underground">
              <div class="theme-preview"></div>
              <div class="theme-name">üï≥Ô∏è –ó–µ–º–ª—è–Ω–∫–∞</div>
              <div class="theme-description">–ü–æ–¥–ø–æ–ª—å–Ω–æ–µ –∫–∞–∑–∏–Ω–æ</div>
            </div>
            <div class="theme-option" data-theme="tavern">
              <div class="theme-preview"></div>
              <div class="theme-name">üç∫ –¢–∞–≤–µ—Ä–Ω–∞</div>
              <div class="theme-description">–£—é—Ç–Ω–∞—è —Ç–∞–≤–µ—Ä–Ω–∞</div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Profile Settings Overlay -->
    <div class="profile-overlay" id="profileOverlay"></div>

    <!-- Profile Settings Modal -->
    <div class="profile-modal" id="profileModal">
      <div class="profile-header">
        <h2 class="profile-title">–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ—Ñ–∏–ª—è</h2>
        <button class="profile-close" id="profileClose">√ó</button>
      </div>
      <div class="profile-content">
        <div class="profile-avatar-section">
          <div class="avatar-container">
            <div class="avatar" id="userAvatar">üë§</div>
            <button class="avatar-change-btn" id="avatarChangeBtn">–ò–∑–º–µ–Ω–∏—Ç—å</button>
          </div>
        </div>
        <div class="profile-info-section">
          <div class="input-group">
            <label for="telegramUsername" class="input-label">Telegram Username</label>
            <input type="text" id="telegramUsername" class="profile-input" placeholder="–ù–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ" disabled readonly>
          </div>
          <div class="input-group">
            <label for="telegramFirstName" class="input-label">Telegram –ò–º—è</label>
            <input type="text" id="telegramFirstName" class="profile-input" placeholder="–ù–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ" disabled readonly>
          </div>
          <div class="input-group">
            <label for="telegramUserId" class="input-label">Telegram User ID</label>
            <input type="text" id="telegramUserId" class="profile-input" placeholder="–ù–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ" disabled readonly>
          </div>
          <div class="input-group">
            <label for="userNickname" class="input-label">–ù–∏–∫–Ω–µ–π–º (–∏–∑–º–µ–Ω—è–µ–º—ã–π)</label>
            <input type="text" id="userNickname" class="profile-input" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∏–∫–Ω–µ–π–º" maxlength="20">
          </div>
        </div>
        <div class="profile-actions">
          <button class="profile-save-btn" id="profileSaveBtn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
          <button class="profile-cancel-btn" id="profileCancelBtn">–û—Ç–º–µ–Ω–∞</button>
          <button class="profile-debug-btn" id="profileDebugBtn" style="background: #ff6b6b; color: white; border: none; padding: 12px 20px; border-radius: 8px; cursor: pointer; margin-top: 15px; font-weight: bold; font-size: 14px; box-shadow: 0 2px 8px rgba(255, 107, 107, 0.3);">üîç –û—Ç–ª–∞–¥–∫–∞ Telegram</button>
        </div>
      </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –≤–µ—Ä—Å–∏–∏ -->
    <div class="modal" id="versionModal" style="display: none;">
      <div class="modal-content">
        <div class="modal-header">
          <h2>üì± –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –≤–µ—Ä—Å–∏–∏</h2>
          <button class="modal-close" id="versionModalClose">√ó</button>
        </div>
        <div class="modal-body">
          <div id="versionInfo" style="background: #f5f5f5; padding: 15px; border-radius: 8px; font-family: monospace; font-size: 14px; white-space: pre-wrap;">
            –ó–∞–≥—Ä—É–∑–∫–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –≤–µ—Ä—Å–∏–∏...
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-primary" id="versionModalOk">–û–ö</button>
        </div>
      </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –æ—Ç–ª–∞–¥–∫–∏ Telegram -->
    <div class="modal" id="debugModal" style="display: none;">
      <div class="modal-content">
        <div class="modal-header">
          <h2>üîç –û—Ç–ª–∞–¥–∫–∞ Telegram WebApp</h2>
          <button class="modal-close" id="debugModalClose">√ó</button>
        </div>
        <div class="modal-body">
          <div id="debugInfo" style="background: #f5f5f5; padding: 15px; border-radius: 8px; font-family: monospace; font-size: 12px; white-space: pre-wrap; max-height: 400px; overflow-y: auto;">
            –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –æ—Ç–ª–∞–¥–∫–∏...
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-primary" id="debugModalOk">–û–ö</button>
          <button class="btn btn-secondary" id="testParsingBtn" style="background: #ff9800; color: white; border: none; padding: 8px 16px; border-radius: 4px; margin-left: 10px;">üß™ –¢–µ—Å—Ç –ø–∞—Ä—Å–∏–Ω–≥–∞</button>
        </div>
      </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ -->
    <div class="modal" id="achievementsModal" style="display: none;">
      <div class="modal-content achievements-modal">
        <!-- –®–∞–ø–∫–∞ —Å –∑–∞–≥–æ–ª–æ–≤–∫–æ–º, —É—Ä–æ–≤–Ω–µ–º –∏ –∫–Ω–æ–ø–∫–æ–π –∑–∞–∫—Ä—ã—Ç–∏—è -->
        <div class="modal-header">
          <h2>–î–æ—Å—Ç–∏–∂–µ–Ω–∏—è</h2>
          <div class="modal-header-right">
            <span class="level-badge" id="playerLevel">–£–†–û–í–ï–ù–¨ 1</span>
            <button class="modal-close" id="achievementsModalClose">&times;</button>
          </div>
        </div>
        
        <!-- –§–∏–ª—å—Ç—Ä—ã (—Ç–∞–±—ã) -->
        <div class="achievements-tabs">
          <button class="tab active" data-tab="all">–í—Å–µ</button>
          <button class="tab" data-tab="unlocked">–ü–æ–ª—É—á–µ–Ω–Ω—ã–µ</button>
          <button class="tab" data-tab="locked">–ó–∞–±–ª–æ–∫–∏—Ä.</button>
        </div>
        
        <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –ø—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ -->
        <div class="modal-body">
          <div class="achievements-grid" id="achievementsGrid">
            <!-- –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è –±—É–¥—É—Ç —Ä–µ–Ω–¥–µ—Ä–∏—Ç—å—Å—è –∑–¥–µ—Å—å -->
          </div>
        </div>
        
        <!-- –§—É—Ç–µ—Ä —Å –∫–Ω–æ–ø–∫–∞–º–∏ -->
        <div class="modal-footer">
          <button class="btn btn-secondary" id="exportStatsBtn">üíæ –≠–∫—Å–ø–æ—Ä—Ç</button>
          <button class="btn btn-primary" id="achievementsModalOk">–û–ö</button>
        </div>
      </div>
    </div>

    <script src="./script.js?v=129"></script>
  </body>
</html>