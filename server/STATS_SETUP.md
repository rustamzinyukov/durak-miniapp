# üìä –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–∏—Å—Ç–µ–º—ã —Å–±–æ—Ä–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏

## üéØ –û–±–∑–æ—Ä

–°–∏—Å—Ç–µ–º–∞ —Å–æ–±–∏—Ä–∞–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∏–≥—Ä–æ–∫–æ–≤ –≤ PostgreSQL –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç API –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –¥–∞–Ω–Ω—ã–º.

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

```
server/
‚îú‚îÄ‚îÄ database/
‚îÇ   ‚îú‚îÄ‚îÄ schema.sql          # SQL —Å—Ö–µ–º–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îî‚îÄ‚îÄ db.js               # –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ PostgreSQL
‚îú‚îÄ‚îÄ api/
‚îÇ   ‚îî‚îÄ‚îÄ stats.js            # API endpoints –¥–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
‚îú‚îÄ‚îÄ public/
‚îÇ   ‚îî‚îÄ‚îÄ admin.html          # –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
‚îú‚îÄ‚îÄ get-user-photo.js       # –ì–ª–∞–≤–Ω—ã–π —Ñ–∞–π–ª —Å–µ—Ä–≤–µ—Ä–∞
‚îî‚îÄ‚îÄ package.json
```

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
cd server
npm install
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ PostgreSQL –Ω–∞ Railway

1. –í–æ–π–¥–∏—Ç–µ –≤ Railway Dashboard
2. –û—Ç–∫—Ä–æ–π—Ç–µ –≤–∞—à –ø—Ä–æ–µ–∫—Ç `durak-miniapp`
3. –î–æ–±–∞–≤—å—Ç–µ PostgreSQL:
   - Click "+ New Service"
   - Select "Database" ‚Üí "PostgreSQL"
4. Railway –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—Å—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è `DATABASE_URL`

### 3. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

–ü—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ —Å–µ—Ä–≤–µ—Ä –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
- –°–æ–∑–¥–∞—Å—Ç –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Ç–∞–±–ª–∏—Ü—ã
- –°–æ–∑–¥–∞—Å—Ç –∏–Ω–¥–µ–∫—Å—ã
- –°–æ–∑–¥–∞—Å—Ç –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è (views) –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏

### 4. –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞

–õ–æ–∫–∞–ª—å–Ω–æ:
```bash
npm run dev
```

–ù–∞ Railway:
- –°–µ—Ä–≤–µ—Ä –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è

## üì° API Endpoints

### –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∏–≥—Ä–æ–∫–∞

```http
POST /api/stats
Content-Type: application/json

{
  "telegram_user_id": 123456789,
  "username": "player123",
  "first_name": "John",
  "last_name": "Doe",
  "stats": {
    "totalGames": 50,
    "wins": 30,
    "losses": 20,
    "currentStreak": 3,
    "bestStreak": 5,
    "lastResult": "win",
    "achievements": {...},
    "detailed": {...}
  }
}
```

### –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∑–∞–ø–∏—Å—å –æ–± –∏–≥—Ä–µ

```http
POST /api/stats/game
Content-Type: application/json

{
  "telegram_user_id": 123456789,
  "result": "win",
  "duration": 180,
  "cards_played": 15,
  "theme": "casino"
}
```

### –ü–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∏–≥—Ä–æ–∫–∞

```http
GET /api/stats/:telegram_user_id
```

### –ü–æ–ª—É—á–∏—Ç—å —Ç–∞–±–ª–∏—Ü—É –ª–∏–¥–µ—Ä–æ–≤

```http
GET /api/stats/leaderboard?limit=100&offset=0
```

### –ü–æ–ª—É—á–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–µ –∏–≥—Ä—ã

```http
GET /api/stats/recent-games?limit=100&offset=0
```

### –ü–æ–ª—É—á–∏—Ç—å –æ–±—â—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É

```http
GET /api/stats/summary
```

## üñ•Ô∏è –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å

–ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è –æ—Ç–∫—Ä–æ–π—Ç–µ:
```
https://durak-miniapp-production.up.railway.app/admin/admin.html
```

–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç:
- ‚úÖ –û–±—â—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É (–∏–≥—Ä–æ–∫–∏, –∏–≥—Ä—ã, –ø–æ–±–µ–¥—ã)
- ‚úÖ –¢–∞–±–ª–∏—Ü—É –ª–∏–¥–µ—Ä–æ–≤ (—Ç–æ–ø-50 –∏–≥—Ä–æ–∫–æ–≤)
- ‚úÖ –ü–æ—Å–ª–µ–¥–Ω–∏–µ –∏–≥—Ä—ã (–ø–æ—Å–ª–µ–¥–Ω–∏–µ 50 –∏–≥—Ä)

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

### 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î

```bash
curl https://durak-miniapp-production.up.railway.app/health
```

### 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å API —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏

```bash
curl https://durak-miniapp-production.up.railway.app/api/stats/summary
```

### 3. –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É

```bash
curl -X POST https://durak-miniapp-production.up.railway.app/api/stats \
  -H "Content-Type: application/json" \
  -d '{
    "telegram_user_id": 999999,
    "username": "test_user",
    "first_name": "Test",
    "stats": {
      "totalGames": 1,
      "wins": 1,
      "losses": 0,
      "currentStreak": 1,
      "bestStreak": 1,
      "lastResult": "win"
    }
  }'
```

## üìä –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

### –¢–∞–±–ª–∏—Ü—ã

**player_stats** - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏–≥—Ä–æ–∫–æ–≤
- –ü–æ–ª—è: id, telegram_user_id, username, first_name, total_games, wins, losses, etc.
- –ò–Ω–¥–µ–∫—Å—ã: telegram_user_id (unique), updated_at, total_games

**game_history** - –ò—Å—Ç–æ—Ä–∏—è –∏–≥—Ä
- –ü–æ–ª—è: id, telegram_user_id, result, duration, cards_played, theme, played_at
- –ò–Ω–¥–µ–∫—Å—ã: telegram_user_id, played_at

### –ü—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è (Views)

**top_players** - –¢–æ–ø –∏–≥—Ä–æ–∫–æ–≤ –ø–æ –ø–æ–±–µ–¥–∞–º
**recent_games** - –ü–æ—Å–ª–µ–¥–Ω–∏–µ –∏–≥—Ä—ã —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ–± –∏–≥—Ä–æ–∫–∞—Ö

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

–í –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è:
1. –î–æ–±–∞–≤–∏—Ç—å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é –¥–ª—è –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏
2. –í–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å telegram_user_id —á–µ—Ä–µ–∑ Telegram Bot API
3. –î–æ–±–∞–≤–∏—Ç—å rate limiting –¥–ª—è API endpoints

## üêõ –û—Ç–ª–∞–¥–∫–∞

–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –Ω–∞ Railway:
```
railway logs
```

–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î –ª–æ–∫–∞–ª—å–Ω–æ:
```javascript
const { Pool } = require('pg');
const pool = new Pool({ connectionString: process.env.DATABASE_URL });
pool.query('SELECT NOW()', (err, res) => {
  console.log(err, res);
  pool.end();
});
```

## üìù –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä **–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ** - –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç –∏–≥—Ä—É
- –ü—Ä–∏ –æ—à–∏–±–∫–µ –æ—Ç–ø—Ä–∞–≤–∫–∏ –∏–≥—Ä–∞ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç—Å—è –Ω–æ—Ä–º–∞–ª—å–Ω–æ
- –î–∞–Ω–Ω—ã–µ –¥—É–±–ª–∏—Ä—É—é—Ç—Å—è –≤ Telegram Cloud Storage (—Ä–µ–∑–µ—Ä–≤)
- –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è –±—ã—Å—Ç—Ä—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

