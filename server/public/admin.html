<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–î—É—Ä–∞–∫ - –ê–¥–º–∏–Ω –ü–∞–Ω–µ–ª—å</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
    }

    h1 {
      color: white;
      text-align: center;
      margin-bottom: 30px;
      font-size: 2.5rem;
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
    }

    .stats-cards {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .stat-card {
      background: white;
      border-radius: 10px;
      padding: 20px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      text-align: center;
    }

    .stat-card h3 {
      color: #667eea;
      font-size: 0.9rem;
      margin-bottom: 10px;
      text-transform: uppercase;
    }

    .stat-card .value {
      font-size: 2rem;
      font-weight: bold;
      color: #333;
    }

    .section {
      background: white;
      border-radius: 10px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    .section h2 {
      color: #667eea;
      margin-bottom: 15px;
      border-bottom: 2px solid #667eea;
      padding-bottom: 10px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
    }

    th, td {
      padding: 12px;
      text-align: left;
      border-bottom: 1px solid #eee;
    }

    th {
      background: #f8f9fa;
      color: #667eea;
      font-weight: 600;
    }

    tr:hover {
      background: #f8f9fa;
    }

    .loading {
      text-align: center;
      padding: 40px;
      color: #667eea;
      font-size: 1.2rem;
    }

    .error {
      background: #ff4444;
      color: white;
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 20px;
    }

    .refresh-btn {
      background: #667eea;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 1rem;
      margin-bottom: 20px;
    }

    .refresh-btn:hover {
      background: #5568d3;
    }

    .badge {
      display: inline-block;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 0.85rem;
      font-weight: 600;
    }

    .badge-gold {
      background: #FFD700;
      color: #333;
    }

    .badge-silver {
      background: #C0C0C0;
      color: #333;
    }

    .badge-bronze {
      background: #CD7F32;
      color: white;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üéÆ –î—É—Ä–∞–∫ - –ê–¥–º–∏–Ω –ü–∞–Ω–µ–ª—å –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏</h1>
    
    <button class="refresh-btn" onclick="loadAllData()">üîÑ –û–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ</button>
    
    <div id="error-message"></div>
    
    <!-- Summary Stats Cards -->
    <div class="stats-cards">
      <div class="stat-card">
        <h3>–í—Å–µ–≥–æ –∏–≥—Ä–æ–∫–æ–≤</h3>
        <div class="value" id="totalPlayers">-</div>
      </div>
      <div class="stat-card">
        <h3>–í—Å–µ–≥–æ –∏–≥—Ä</h3>
        <div class="value" id="totalGames">-</div>
      </div>
      <div class="stat-card">
        <h3>–ü–æ–±–µ–¥</h3>
        <div class="value" id="totalWins">-</div>
      </div>
      <div class="stat-card">
        <h3>–ü–æ—Ä–∞–∂–µ–Ω–∏–π</h3>
        <div class="value" id="totalLosses">-</div>
      </div>
      <div class="stat-card">
        <h3>–°—Ä–µ–¥–Ω–∏–π % –ø–æ–±–µ–¥</h3>
        <div class="value" id="avgWinRate">-</div>
      </div>
    </div>

    <!-- Top Players Leaderboard -->
    <div class="section">
      <h2>üèÜ –¢–æ–ø –ò–≥—Ä–æ–∫–æ–≤</h2>
      <div class="loading" id="leaderboardLoading">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
      <table id="leaderboardTable" style="display:none;">
        <thead>
          <tr>
            <th>#</th>
            <th>–ò–º—è</th>
            <th>–£—Ä–æ–≤–µ–Ω—å</th>
            <th>–û—á–∫–æ–≤</th>
            <th>–ò–≥—Ä</th>
            <th>–ü–æ–±–µ–¥</th>
            <th>–ü–æ—Ä–∞–∂–µ–Ω–∏–π</th>
            <th>% –ü–æ–±–µ–¥</th>
            <th>–õ—É—á—à–∞—è —Å–µ—Ä–∏—è</th>
          </tr>
        </thead>
        <tbody id="leaderboardBody"></tbody>
      </table>
    </div>

    <!-- Recent Games -->
    <div class="section">
      <h2>üìä –ü–æ—Å–ª–µ–¥–Ω–∏–µ –∏–≥—Ä—ã</h2>
      <div class="loading" id="gamesLoading">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
      <table id="gamesTable" style="display:none;">
        <thead>
          <tr>
            <th>ID</th>
            <th>–ò–≥—Ä–æ–∫</th>
            <th>–†–µ–∑—É–ª—å—Ç–∞—Ç</th>
            <th>–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å</th>
            <th>–ö–∞—Ä—Ç —Å—ã–≥—Ä–∞–Ω–æ</th>
            <th>–¢–µ–º–∞</th>
            <th>–í—Ä–µ–º—è</th>
          </tr>
        </thead>
        <tbody id="gamesBody"></tbody>
      </table>
    </div>
  </div>

  <script>
    const API_URL = window.location.origin;

    async function loadSummary() {
      try {
        const response = await fetch(`${API_URL}/api/stats/summary`);
        const data = await response.json();
        
        if (data.success) {
          document.getElementById('totalPlayers').textContent = data.data.total_players || 0;
          document.getElementById('totalGames').textContent = data.data.total_games || 0;
          document.getElementById('totalWins').textContent = data.data.total_wins || 0;
          document.getElementById('totalLosses').textContent = data.data.total_losses || 0;
          document.getElementById('avgWinRate').textContent = `${data.data.avg_win_rate || 0}%`;
        }
      } catch (error) {
        console.error('Error loading summary:', error);
        showError('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–≤–æ–¥–∫–∏');
      }
    }

    async function loadLeaderboard() {
      try {
        const response = await fetch(`${API_URL}/api/stats/leaderboard?limit=50`);
        const data = await response.json();
        
        document.getElementById('leaderboardLoading').style.display = 'none';
        document.getElementById('leaderboardTable').style.display = 'table';
        
        const tbody = document.getElementById('leaderboardBody');
        tbody.innerHTML = '';
        
        if (data.success && data.data.length > 0) {
          data.data.forEach((player, index) => {
            const row = document.createElement('tr');
            const badge = index === 0 ? 'badge-gold' : index === 1 ? 'badge-silver' : index === 2 ? 'badge-bronze' : '';
            row.innerHTML = `
              <td><span class="badge ${badge}">${index + 1}</span></td>
              <td>${player.first_name || player.username || 'Unknown'}</td>
              <td>Level ${player.level || 1}</td>
              <td>${player.points || 0}</td>
              <td>${player.total_games}</td>
              <td>${player.wins}</td>
              <td>${player.losses}</td>
              <td>${player.win_rate}%</td>
              <td>${player.best_streak || 0}</td>
            `;
            tbody.appendChild(row);
          });
        } else {
          tbody.innerHTML = '<tr><td colspan="9" style="text-align:center;">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</td></tr>';
        }
      } catch (error) {
        console.error('Error loading leaderboard:', error);
        showError('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ä–µ–π—Ç–∏–Ω–≥–∞');
      }
    }

    async function loadRecentGames() {
      try {
        const response = await fetch(`${API_URL}/api/stats/recent-games?limit=50`);
        const data = await response.json();
        
        document.getElementById('gamesLoading').style.display = 'none';
        document.getElementById('gamesTable').style.display = 'table';
        
        const tbody = document.getElementById('gamesBody');
        tbody.innerHTML = '';
        
        if (data.success && data.data.length > 0) {
          data.data.forEach(game => {
            const row = document.createElement('tr');
            const resultColor = game.result === 'win' ? 'green' : 'red';
            const resultText = game.result === 'win' ? '‚úÖ –ü–æ–±–µ–¥–∞' : '‚ùå –ü–æ—Ä–∞–∂–µ–Ω–∏–µ';
            row.innerHTML = `
              <td>${game.id}</td>
              <td>${game.first_name || game.username || 'Unknown'}</td>
              <td style="color:${resultColor};">${resultText}</td>
              <td>${game.duration ? Math.round(game.duration / 60) + ' –º–∏–Ω' : '-'}</td>
              <td>${game.cards_played || '-'}</td>
              <td>${game.theme || '-'}</td>
              <td>${new Date(game.played_at).toLocaleString('ru-RU')}</td>
            `;
            tbody.appendChild(row);
          });
        } else {
          tbody.innerHTML = '<tr><td colspan="7" style="text-align:center;">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</td></tr>';
        }
      } catch (error) {
        console.error('Error loading recent games:', error);
        showError('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏—Å—Ç–æ—Ä–∏–∏ –∏–≥—Ä');
      }
    }

    function showError(message) {
      const errorDiv = document.getElementById('error-message');
      errorDiv.innerHTML = `<div class="error">${message}</div>`;
      setTimeout(() => {
        errorDiv.innerHTML = '';
      }, 5000);
    }

    async function loadAllData() {
      console.log('Loading all data...');
      await Promise.all([
        loadSummary(),
        loadLeaderboard(),
        loadRecentGames()
      ]);
    }

    // Load data on page load
    window.addEventListener('load', loadAllData);
  </script>
</body>
</html>

